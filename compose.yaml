networks:
  elastic-net:
    name: elastic-net
    driver: bridge

services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.15.1
    container_name: elasticsearch
    ports:
      - "127.0.0.1:9200:9200"
    environment:
      - ELASTIC_PASSWORD=changeme
      - discovery.type=single-node
      - xpack.security.http.ssl.enabled=false
      - xpack.license.self_generated.type=trial
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    volumes:
      - elasticsearch-data:/usr/share/elasticsearch/data
    networks:
      - elastic-net
    restart: unless-stopped
    mem_limit: 1g

  ollama:
    image: ollama/ollama:latest
    ports:
        - 11434:11434
    volumes:
        - ./ollama/data:/root/.ollama
        - ./ollama/entrypoint.sh:/entrypoint.sh:ro
    container_name: ollama
    pull_policy: always
    tty: true
    restart: always
    entrypoint: ["/usr/bin/bash", "/entrypoint.sh"]
    networks:
      - elastic-net
    env_file:
      - .env

  ollama-webui:
    image: ghcr.io/ollama-webui/ollama-webui:main
    container_name: ollama-webui
    ports:
      - "3001:8080"
    depends_on:
      - ollama
    environment:
      - OLLAMA_API_BASE_URL=http://ollama:11434/api
    networks:
      - elastic-net
    restart: unless-stopped

  cognee:
    image: cognee/cognee:main
    container_name: cognee
    ports:
      - "8000:8000"
    volumes:
      - ./cognee/data:/root/.cognee
    env_file:
      - .env.cognee
    networks:
      - elastic-net
    restart: unless-stopped

  cognee-mcp:
    image: cognee/cognee-mcp:main
    container_name: cognee-mcp
    ports:
      - "8001:8000"
    environment:
      - TRANSPORT_MODE=sse
      - API_URL=http://cognee:8000
    networks:
      - elastic-net
    depends_on:
      - cognee
    restart: unless-stopped

volumes:
  elasticsearch-data:
  ollama_data:
